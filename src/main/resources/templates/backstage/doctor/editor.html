<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>新增界面</title>
    <script src="../static/layui/layui.js" data-th-src="@{/layui/layui.js}"></script>
    <link rel="stylesheet" data-th-href="@{/layui/css/layui.css}" href="../static/layui/css/layui.css">
    <script data-th-inline="javascript">
        layui.config({
            base: '[(@{/layui/extends/})]',
        }).extend({
            authtree: 'authtree/authtree',
            xmSelect: 'xmSelect/xm-select'
        });
    </script>
    <style>
        body{
            padding-right: 15px;
            padding-top: 15px;
        }
    </style>
</head>
<body>

<form class="layui-form" action="">
    <input type="hidden" data-th-value="${doctor?.doctorId}">
    <div class="layui-form-item">
        <label class="layui-form-label">医生工号</label>
        <div class="layui-input-inline">
            <input type="text" name="jobNumber" lay-verify="required" data-th-value="${doctor?.doctorId}" autocomplete="off" placeholder="请输入标题" class="layui-input">
        </div>
    </div>

<!--    二级联动父子科室-->
    <div class="layui-form-item">
        <label class="layui-form-label">父科室</label>
        <div class="layui-input-inline">
            <select lay-search="" lay-verify="required" id="parents" name="parents" lay-filter="parents">
                <option value="">请选择父科室</option>
                <option data-th-each="parent:${parents}" selected="${doctor?.parent?.departId==parent.departId}?selected:_" data-th-value="${parent.departId}" data-th-text="${parent.departName}" >${parent.departName}</option>
            </select>
        </div>
    </div>

    <div class="layui-form-item">
        <label class="layui-form-label">子科室</label>
        <div class="layui-input-inline">
            <select name="departId" id="departId" lay-verify="required"></select>
        </div>
    </div>

    <div class="layui-form-item">
        <label class="layui-form-label">医生姓名</label>
        <div class="layui-input-inline">
            <input type="text" name="name" lay-verify="required" lay-reqtext="医生姓名，岂能为空？" placeholder="请输入" autocomplete="off" class="layui-input">
        </div>
    </div>

    <div class="layui-form-item">
        <label class="layui-form-label">性别</label>
        <div class="layui-input-inline">
            <input type="radio" name="sex" value="1" title="男" checked="">
            <input type="radio" name="sex" value="2" title="女">
            <input type="radio" name="sex" value="禁" title="禁用" disabled="">
        </div>
    </div>

    <div class="layui-form-item">
        <label class="layui-form-label">医生图片</label>
        <div class="layui-input-inline">
            <input type="text" name="username"  lay-reqtext="用户名是必填项，岂能为空？" placeholder="请输入" autocomplete="off" class="layui-input">
        </div>
    </div>

    <div class="layui-form-item">
        <div class="layui-inline">
            <label class="layui-form-label">出生日期</label>
            <div class="layui-input-inline">
                <input type="text" name="birth" class="layui-input" id="test30" placeholder="yyyy-MM-dd">
            </div>
        </div>
    </div>


    <div class="layui-form-item">
        <label class="layui-form-label">医生职位</label>
        <div class="layui-input-inline">
            <input type="text" name="position" lay-verify="required" lay-reqtext="用户名是必填项，岂能为空？" placeholder="请输入" autocomplete="off" class="layui-input">
        </div>
    </div>
    <div class="layui-form-item">
        <label class="layui-form-label">工作经验</label>
        <div class="layui-input-inline">
            <input type="text" name="workExperience"  placeholder="请输入" autocomplete="off" class="layui-input">
        </div>
    </div>

    <div class="layui-form-item">
        <div class="layui-inline">
            <label class="layui-form-label">输入手机号</label>
            <div class="layui-input-inline">
                <input type="tel" name="phone" lay-verify="required|phone" autocomplete="off" class="layui-input">
            </div>
        </div>
    </div>
    <div class="layui-form-item">
        <label class="layui-form-label">擅长</label>
        <div class="layui-input-inline">
            <input type="text" name="adept" placeholder="请输入" autocomplete="off" class="layui-input">
        </div>
    </div>
    <div class="layui-form-item layui-form-text">
        <label class="layui-form-label">医生介绍</label>
        <div class="layui-input-inline">
            <textarea name="introduce" placeholder="请输入内容" class="layui-textarea"></textarea>
        </div>
    </div>
    <div class="layui-form-item">
        <div class="layui-input-block">
            <button type="submit" class="layui-btn" lay-submit lay-filter="formSubmit">立即提交</button>
            <button type="reset" class="layui-btn layui-btn-primary">重置</button>
        </div>
    </div>
</form>
<script data-th-inline="javascript">
    layui.use(['form','jquery','xmSelect','laydate'], function() {
        let {form,$,xmSelect,laydate} = layui;
        //自定义颜色
        laydate.render({
            elem: '#test30'
            ,theme: '#393D49'
        });


        //监听提交
        form.on('submit(formSubmit)', function (data) {
            console.log(data);
            $.ajax({
                url: /*[[@{/doctors}]]*/ '/save',
                type: 'put',
                data: data.field,
                dataType:'json',
                success:function (rs) {
                   if(rs.code==0){
                       var index = parent.layer.getFrameIndex(window.name); //获取窗口索引
                       parent.layer.close(index);//关闭当前窗口
                       parent.layer.msg(rs.msg,{icon:6});//在父页面弹出提示框
                       parent.layui.table.reload('reload');//重载父页面的表格数据
                   }else{
                       layer.msg(rs.msg,{icon:5});
                   }
                }
            });
            return false;
        });

        //监听到了下拉框选择的选项，传递过来
        form.on('select(parents)',function (data) {
            //监听到了下拉框选择的选项，传递过来
            // console.log(data);//在控制台输出信息
            var dId = data.value;
            // console.log(dId);
            //再利用ajax将数据传到后端，来获取到对应下拉框选项而出现的值
            $.ajax({
                type: "post",
                url: "/doctors/getType",
                data: {"dId":dId},
                dataType: "json",
                success: function (d) {
                    // layer.alert(1122)
                    //对应的值传回，拼出html下拉框语句
                    console.log(d);
                    console.log(d.data);
                    var tmp='';
                    for (var i in d.data){
                        tmp +='<option name="departId" selected="" value="'+d.data[i].departId+'">'+d.data[i].departName+'</option>';
                    }
                    $("#departId").html(tmp);
                    form.render();
                },error:function () {
                    layer.msg("请求失败！",{icon:5});
                }
            });
        })
    });
</script>
</body>
</html>